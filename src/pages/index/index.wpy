<template>
    <view class='main'>
        <view wx:if="{{shouquan}}">
            <text class="text">è¯·ç‚¹å‡»æˆæƒä¿¡æ¯</text>
            <button 
                wx:if="{{canIUse}}"
                class="button" 
                open-type="getUserInfo" 
                bindgetuserinfo="bindGetUserInfo">æˆæƒç™»å½•</button>
            <view wx:else>è¯·å‡çº§å¾®ä¿¡ç‰ˆæœ¬</view>
        </view>
        <view wx:else>æ‚¨æ²¡æœ‰æƒé™</view>
    </view>
</template>

<script>
import wepy from 'wepy';
export default class Index extends wepy.page {
  config = {
    navigationBarTitleText: 'æˆæƒ'
  };
  data = {
    //åˆ¤æ–­å°ç¨‹åºçš„APIï¼Œå›è°ƒï¼Œå‚æ•°ï¼Œç»„ä»¶ç­‰æ˜¯å¦åœ¨å½“å‰ç‰ˆæœ¬å¯ç”¨ã€‚
    canIUse: wx.canIUse('button.open-type.getUserInfo'),
    shouquan:true
  };
  methods={      
    bindGetUserInfo(e) {
        if (e.detail.userInfo.nickName=="ğŸ˜ƒ"){
            //ç”¨æˆ·æŒ‰äº†å…è®¸æˆæƒæŒ‰é’®
            console.log(e.detail.userInfo)
            wx.redirectTo({ url:"../menu/menu"})
            } else {
              this.shouquan=false;
            }
        
    }
  }
  onLoad() {
     // æŸ¥çœ‹æ˜¯å¦æˆæƒ
    const that=this
    wx.getSetting({
      success: function(res){
        if (res.authSetting['scope.userInfo']) {
          wx.getUserInfo({
            success: function(res) {
              console.log(res.userInfo)
              //wx.redirectTo({ url:"../menu/menu"})
            }
          })
        }
      }
    })
  }  
}
</script>

<style lang="less">
.main{
    text-align: center;
    padding-top:100px;
    .text{
        font-size: 16px;        
    }
    button{
        width:50%;
        font-size: 14px;
        margin-top:20px;  
    }
}
</style>
